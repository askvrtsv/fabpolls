# fabpolls

## Запуск

```
docker build . -t fabpolls

docker run -it --rm -v fabpolls_data:/opt/fabpolls/data -p 8000:8000 fabpolls python manage.py migrate

docker run -it --rm -v fabpolls_data:/opt/fabpolls/data -p 8000:8000 fabpolls python manage.py loaddata polls/fixtures/example_data.json

docker run -it --rm -v fabpolls_data:/opt/fabpolls/data -p 8000:8000 fabpolls
```

После выполнения команд будут созданы два пользователя:

- admin@example.com — админ, пароль: 123456
- user@example.com — обычный пользователь, пароль: 123456


## API

Для авторизации требуется передавать заголовок `Authorization` со значением токена. Например, `Authorization: Token 96b9540385351a64d6ae52ae3d504994ced52d9c`.

### /login/ POST — получение токена

Параметры: `username` и `password`.

Успешный запрос возвращает токен. 

Пример запроса: `{"username":"admin@example.com","password":"123456"}`


### /polls/ POST — создание опроса

Ожидает следующие параметры: `name`, `start_date` и `finish_date`. Параметры `start_date` и `finish_date` должны быть представлены в формате `YYYY-MM-DD`.

︎Доступно только для администратора.


### /polls/ GET — опубликованные запросы

Возвращает список опубликованных опросов: активных и завершенных. Для администратора возвращает еще неопубликованные опросы.


### /polls/:id/ GET — опрос и его вопросы

Возвращает опрос и его вопросы.

 
### /polls/:id/ PUT — редактирование опроса

Ожидает следующие параметры: `name` и `finish_date`. Параметр `finish_date` должен быть представлен в формате `YYYY-MM-DD`.

Доступно только для администратора.


### /polls/:id/pass/(?auid)? POST — прохождение опроса

Ожидает список объектов со следующими параметрами: `question`, `answer_text`, `choices`. Параметр `question` должен быть идентификатором вопроса, на который дается ответ. Если ответ на вопрос должен быть текстом, то текст передается в параметре `answer_text`. Если ответ предполагает выбор варианта/вариантов ответа, то идентификаторы вариантов ответа передаются списком в параметре `choices`.

Например:

```
[
  {
    "question": 1,
    "answer_text": "Антон"
  },
  {
    "question": 2,
    "choices": [1, 2]
  }
]
```


Чтобы пройти опрос анонимно необходимо передать GET-параметр `auid` с целочисленным значением.

Если параметр `auid` не передан, то пользователь определяется по токену.

Сервис запрещает повторное прохождение опроса одним и тем же пользователем.


### /polls/passed/?(auid|user) GET — список пройденных опросов пользователем

Возвращает список опросов с ответами указанного пользователя. Чтобы получить ответы анонимного пользователя необходимо передать GET-параметр `auid` с целочисленными значением — идентификатором анонимного пользователя, указанным при прохождении теста. Чтобы получить ответы обычного пользователя необходимо передать GET-параметр с его идентификатором.  


### /polls/:id/ DELETE — удаление опроса

Доступно только для администратора.


### /polls/:id/publish POST — публикация опроса

Доступно только для администратора.


### /questions/ POST — создание вопроса

Ожидает следующие параметры: `question_text`, `poll` и `question_type`. Параметр `poll` должен быть идентификатором уже созданного опроса. Параметр `question_type` может принимать одно из следующих значений `T` (ответ текстом), `1` (выбор одного варианта ответа) и `M` (выбор нескольких вариантов).
 
Доступно только для администратора.


### /answerchoices/ POST — создание варианта ответа

Ожидает следующие параметры: `question`, `choice_text`. Параметр `question` должен быть идентификатором уже созданного вопроса.
 
Доступно только для администратора.

